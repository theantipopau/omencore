<UserControl x:Class="OmenCore.Views.SystemControlView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:controls="clr-namespace:OmenCore.Controls"
             xmlns:utils="clr-namespace:OmenCore.Utils"
             mc:Ignorable="d" 
             d:DesignHeight="700" d:DesignWidth="1000">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="0,0,0,20">
            <TextBlock Text="System Control" Style="{StaticResource Heading1}"/>
            <TextBlock Text="Performance modes, CPU undervolting, GPU switching, and system maintenance" 
                       Style="{StaticResource Caption}"/>
        </StackPanel>

        <ScrollViewer Grid.Row="1" Style="{StaticResource SmoothScrollViewer}" utils:ScrollSpeedBehavior.ScrollSpeedMultiplier="1.2">
            <StackPanel>
                <!-- Performance Mode Section -->
                <Border Style="{StaticResource SurfaceCard}" Padding="20" Margin="0,0,0,20"
                        ToolTip="System power profile affects CPU/GPU performance limits and power consumption">
                    <StackPanel>
                        <TextBlock Text="PERFORMANCE PROFILE" Style="{StaticResource Label}" Margin="0,0,0,8"/>
                        <TextBlock Text="Performance Mode" Style="{StaticResource Heading3}" Margin="0,0,0,8"/>
                        
                        <TextBlock Text="Control system performance profile and power settings." 
                                   Style="{StaticResource Caption}"
                                   FontSize="13"
                                   Margin="0,0,0,20"/>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Grid.Column="0" Text="Mode:" 
                                       FontSize="14" 
                                       Foreground="{StaticResource TextPrimaryBrush}"
                                       VerticalAlignment="Center" Margin="0,0,12,0"/>
                            
                            <ComboBox Grid.Column="1" 
                                      Style="{StaticResource ModernComboBox}"
                                      ItemsSource="{Binding PerformanceModes}"
                                      SelectedItem="{Binding SelectedPerformanceMode}"
                                      Margin="0,0,12,0"/>
                            
                            <Button Grid.Column="2" 
                                    Content="Apply" 
                                    Style="{StaticResource ModernButton}"
                                    Command="{Binding ApplyPerformanceModeCommand}"
                                    Padding="16,8"/>
                        </Grid>

                        <TextBlock Text="{Binding PerformanceModeDescription}" 
                                   FontSize="12" 
                                   Foreground="{StaticResource TextSecondaryBrush}"
                                   Margin="0,12,0,0" TextWrapping="Wrap"/>
                    </StackPanel>
                </Border>

                <!-- CPU Undervolting Section -->
                <Border Style="{StaticResource SurfaceCard}" Padding="24" Margin="0,0,0,16"
                        ToolTip="Reduce CPU voltage to lower temperatures and power consumption. Start conservative (-60mV) and test stability.">
                    <StackPanel>
                        <TextBlock Text="CPU Undervolting" FontSize="20" FontWeight="SemiBold" 
                                   Foreground="{StaticResource TextPrimaryBrush}" Margin="0,0,0,8"/>
                        
                        <Border Background="{StaticResource SurfaceDarkBrush}" 
                                CornerRadius="8" Padding="12" Margin="0,0,0,16"
                                BorderBrush="Orange" BorderThickness="2">
                            <TextBlock FontSize="12" 
                                       Foreground="{StaticResource TextSecondaryBrush}"
                                       TextWrapping="Wrap">
                                <Run Text="⚠️ IMPORTANT SAFETY INFORMATION" FontWeight="Bold" Foreground="Orange" FontSize="13"/>
                                <LineBreak/><LineBreak/>
                                <Run Text="• Incorrect voltage offsets can cause system crashes, data loss, or instability" FontWeight="SemiBold"/>
                                <LineBreak/>
                                <Run Text="• Start with conservative values (-60mV) and test thoroughly"/>
                                <LineBreak/>
                                <Run Text="• After applying, run a stress test (Prime95, Cinebench) for 30+ minutes"/>
                                <LineBreak/>
                                <Run Text="• If system crashes or freezes, reduce offset by 10-20mV"/>
                                <LineBreak/>
                                <Run Text="• Create a System Restore Point before experimenting"/>
                                <LineBreak/><LineBreak/>
                                <Run Text="✓ Benefits: Lower temperatures (5-15°C), improved sustained performance, reduced fan noise"/>
                            </TextBlock>
                        </Border>

                        <!-- Undervolt Status -->
                        <Grid Margin="0,0,0,16">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Grid.Column="0" Text="Status:" 
                                       FontSize="14" 
                                       Foreground="{StaticResource TextPrimaryBrush}"
                                       Margin="0,0,12,0"/>
                            
                            <TextBlock Grid.Column="1" 
                                       Text="{Binding UndervoltStatusText}" 
                                       FontSize="14" 
                                       Foreground="{Binding UndervoltStatusColor}"/>
                        </Grid>
                        
                        <!-- External Controller Warning (XTU/ThrottleStop) -->
                        <Border Background="#2D1F1F"
                                BorderBrush="#F44336"
                                BorderThickness="1"
                                CornerRadius="8"
                                Padding="16"
                                Margin="0,0,0,16"
                                Visibility="{Binding HasExternalUndervoltController, Converter={StaticResource BoolToVisibility}}">
                            <StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                    <TextBlock Text="⚠️" FontSize="16" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                    <TextBlock Text="{Binding ExternalControllerName, StringFormat='{}{0} Detected'}" 
                                               FontSize="15" FontWeight="Bold" 
                                               Foreground="#F44336"/>
                                </StackPanel>
                                
                                <TextBlock Text="{Binding ExternalControllerWarning}" 
                                           FontSize="12" 
                                           Foreground="{StaticResource TextSecondaryBrush}"
                                           TextWrapping="Wrap"
                                           Margin="0,0,0,12"/>
                                
                                <TextBlock Text="How to fix:" 
                                           FontSize="12" FontWeight="SemiBold"
                                           Foreground="{StaticResource TextPrimaryBrush}"
                                           Margin="0,0,0,4"/>
                                
                                <TextBlock Text="{Binding ExternalControllerHowToFix}" 
                                           FontSize="11" 
                                           Foreground="{StaticResource TextSecondaryBrush}"
                                           TextWrapping="Wrap"/>
                            </StackPanel>
                        </Border>

                        <!-- Core Offset -->
                        <StackPanel Margin="0,0,0,16">
                            <Grid Margin="0,0,0,8">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <TextBlock Grid.Column="0" Text="Core Voltage Offset:" 
                                           FontSize="14" 
                                           Foreground="{StaticResource TextPrimaryBrush}"/>
                                
                                <TextBlock Grid.Column="1" 
                                           Text="{Binding RequestedCoreOffset, StringFormat={}{0} mV}" 
                                           FontSize="14" FontWeight="SemiBold"
                                           Foreground="{StaticResource AccentBrush}"/>
                            </Grid>
                            
                            <Slider Minimum="-200" Maximum="0" 
                                    TickFrequency="5" 
                                    TickPlacement="BottomRight"
                                    Value="{Binding RequestedCoreOffset, Mode=TwoWay}"
                                    IsSnapToTickEnabled="True"/>
                            
                            <!-- Tick labels for key values -->
                            <Grid Margin="0,2,0,0">
                                <TextBlock Text="-200" FontSize="9" Foreground="{StaticResource TextTertiaryBrush}" HorizontalAlignment="Left"/>
                                <TextBlock Text="-150" FontSize="9" Foreground="{StaticResource TextTertiaryBrush}" HorizontalAlignment="Left" Margin="50,0,0,0"/>
                                <TextBlock Text="-100" FontSize="9" Foreground="{StaticResource TextTertiaryBrush}" HorizontalAlignment="Center"/>
                                <TextBlock Text="-50" FontSize="9" Foreground="{StaticResource TextTertiaryBrush}" HorizontalAlignment="Right" Margin="0,0,50,0"/>
                                <TextBlock Text="0" FontSize="9" Foreground="{StaticResource TextTertiaryBrush}" HorizontalAlignment="Right"/>
                            </Grid>
                            
                            <TextBlock Text="Recommended: -80 mV to -120 mV" 
                                       FontSize="11" 
                                       Foreground="{StaticResource TextSecondaryBrush}"
                                       Margin="0,4,0,0"/>
                        </StackPanel>

                        <!-- Cache Offset -->
                        <StackPanel Margin="0,0,0,16">
                            <Grid Margin="0,0,0,8">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <TextBlock Grid.Column="0" Text="Cache Voltage Offset:" 
                                           FontSize="14" 
                                           Foreground="{StaticResource TextPrimaryBrush}"/>
                                
                                <TextBlock Grid.Column="1" 
                                           Text="{Binding RequestedCacheOffset, StringFormat={}{0} mV}" 
                                           FontSize="14" FontWeight="SemiBold"
                                           Foreground="{StaticResource AccentBrush}"/>
                            </Grid>
                            
                            <Slider Minimum="-200" Maximum="0" 
                                    TickFrequency="5" 
                                    TickPlacement="BottomRight"
                                    Value="{Binding RequestedCacheOffset, Mode=TwoWay}"
                                    IsSnapToTickEnabled="True"/>
                            
                            <TextBlock Text="Recommended: Same as core offset or slightly higher" 
                                       FontSize="11" 
                                       Foreground="{StaticResource TextSecondaryBrush}"
                                       Margin="0,4,0,0"/>
                        </StackPanel>

                        <!-- Apply Buttons -->
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <Button Grid.Column="1" 
                                    Content="Apply Undervolt" 
                                    Style="{StaticResource ModernButton}"
                                    Command="{Binding ApplyUndervoltCommand}"
                                    Padding="16,8" Margin="0,0,8,0"/>
                            
                            <Button Grid.Column="2" 
                                    Content="Reset to Default" 
                                    Style="{StaticResource ModernButton}"
                                    Command="{Binding ResetUndervoltCommand}"
                                    Padding="16,8"/>
                        </Grid>

                        <!-- Undervolt Presets -->
                        <Expander Header="Quick Presets" Margin="0,16,0,0" IsExpanded="False">
                            <StackPanel Margin="0,12,0,0">
                                <Button Content="Conservative (-60 mV)" 
                                        Style="{StaticResource ModernButton}"
                                        Command="{Binding ApplyUndervoltPresetCommand}"
                                        CommandParameter="-60"
                                        ToolTip="Safe starting point for most CPUs. Low risk of instability."
                                        HorizontalAlignment="Stretch" Margin="0,0,0,8"/>
                                
                                <Button Content="Moderate (-100 mV)" 
                                        Style="{StaticResource ModernButton}"
                                        Command="{Binding ApplyUndervoltPresetCommand}"
                                        CommandParameter="-100"
                                        ToolTip="Good balance of power savings. Test with stress tests before daily use."
                                        HorizontalAlignment="Stretch" Margin="0,0,0,8"/>
                                
                                <Button Content="Aggressive (-140 mV)" 
                                        Style="{StaticResource ModernButton}"
                                        Command="{Binding ApplyAggressiveUndervoltCommand}"
                                        ToolTip="⚠️ High risk! May cause crashes or BSODs. Only for silicon lottery winners."
                                        HorizontalAlignment="Stretch"/>
                            </StackPanel>
                        </Expander>
                    </StackPanel>
                </Border>
                
                <!-- CPU Temperature Limit (TCC Offset) -->
                <Border Style="{StaticResource SurfaceCard}" Padding="24" Margin="0,0,0,16"
                        Visibility="{Binding TccStatus.IsSupported, Converter={StaticResource BoolToVisibility}}">
                    <StackPanel>
                        <TextBlock Text="CPU Temperature Limit" FontSize="20" FontWeight="SemiBold" 
                                   Foreground="{StaticResource TextPrimaryBrush}" Margin="0,0,0,8"/>
                        
                        <TextBlock FontSize="12" Foreground="{StaticResource TextSecondaryBrush}"
                                   Margin="0,0,0,16" TextWrapping="Wrap">
                            <Run Text="Set a maximum temperature for your CPU using TCC Offset. The CPU will throttle when approaching this limit. Useful for reducing heat and fan noise."/>
                        </TextBlock>
                        
                        <!-- Current Status -->
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                            <TextBlock Text="Current: " FontSize="14" Foreground="{StaticResource TextSecondaryBrush}"/>
                            <TextBlock Text="{Binding TccStatusText}" FontSize="14" Foreground="{StaticResource AccentBrush}"/>
                        </StackPanel>
                        
                        <!-- Temperature Limit Slider -->
                        <StackPanel Margin="0,0,0,16">
                            <Grid Margin="0,0,0,8">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <TextBlock Grid.Column="0" Text="Temperature Limit:" 
                                           FontSize="14" 
                                           Foreground="{StaticResource TextPrimaryBrush}"/>
                                
                                <TextBlock Grid.Column="1" 
                                           Text="{Binding RequestedTempLimit, StringFormat={}{0}°C}" 
                                           FontSize="14" FontWeight="SemiBold"
                                           Foreground="{StaticResource AccentBrush}"/>
                            </Grid>
                            
                            <Slider Minimum="0" Maximum="{Binding TccSliderMaximum}" 
                                    TickFrequency="5" 
                                    Value="{Binding RequestedTccOffset, Mode=TwoWay}"
                                    IsSnapToTickEnabled="True"
                                    IsDirectionReversed="True"/>
                            
                            <!-- Slider direction labels -->
                            <Grid Margin="0,2,0,0">
                                <TextBlock Text="← Higher Temps" 
                                           FontSize="10" 
                                           Foreground="{StaticResource TextTertiaryBrush}"
                                           HorizontalAlignment="Left"/>
                                <TextBlock Text="Lower Temps →" 
                                           FontSize="10" 
                                           Foreground="{StaticResource TextTertiaryBrush}"
                                           HorizontalAlignment="Right"/>
                            </Grid>
                            
                            <TextBlock FontSize="11" 
                                       Foreground="{StaticResource TextSecondaryBrush}"
                                       Margin="0,4,0,0">
                                <Run Text="Lower temperature = more throttling but cooler/quieter. Set to TjMax ("/>
                                <Run Text="{Binding TccStatus.TjMax, Mode=OneWay}"/>
                                <Run Text="°C) for no limit."/>
                            </TextBlock>
                        </StackPanel>

                        <!-- Apply Buttons -->
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <Button Grid.Column="1" 
                                    Content="Apply Limit" 
                                    Style="{StaticResource ModernButton}"
                                    Command="{Binding ApplyTccOffsetCommand}"
                                    Padding="16,8" Margin="0,0,8,0"/>
                            
                            <Button Grid.Column="2" 
                                    Content="Remove Limit" 
                                    Style="{StaticResource ModernButton}"
                                    Command="{Binding ResetTccOffsetCommand}"
                                    Padding="16,8"/>
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- AMD Power/Temperature Controls (Ryzen) -->
                <Border Style="{StaticResource SurfaceCard}" Padding="24" Margin="0,0,0,16"
                        Visibility="{Binding IsAmdCpu, Converter={StaticResource BoolToVisibility}}"
                        ToolTip="Control AMD Ryzen power limits (STAPM) and temperature throttle point (Tctl) via SMU.">
                    <StackPanel>
                        <TextBlock Text="AMD Power/Temperature Controls" FontSize="20" FontWeight="SemiBold" 
                                   Foreground="{StaticResource TextPrimaryBrush}" Margin="0,0,0,8"/>
                        
                        <Border Background="{StaticResource SurfaceDarkBrush}" 
                                CornerRadius="8" Padding="12" Margin="0,0,0,16"
                                BorderBrush="#FF9800" BorderThickness="2">
                            <TextBlock FontSize="12" 
                                       Foreground="{StaticResource TextSecondaryBrush}"
                                       TextWrapping="Wrap">
                                <Run Text="ℹ️ AMD POWER MANAGEMENT" FontWeight="Bold" Foreground="#FF9800" FontSize="13"/>
                                <LineBreak/><LineBreak/>
                                <Run Text="• STAPM Limit: Sustained power limit in watts (15W-54W)"/>
                                <LineBreak/>
                                <Run Text="• Temperature Limit: CPU throttle point in °C (75°C-105°C)"/>
                                <LineBreak/>
                                <Run Text="• Lower STAPM = reduced performance but cooler/quieter"/>
                                <LineBreak/>
                                <Run Text="• Higher STAPM = better performance but more heat/fan noise"/>
                                <LineBreak/>
                                <Run Text="• Temperature limit sets thermal throttle threshold"/>
                                <LineBreak/><LineBreak/>
                                <Run Text="✓ Safe ranges: 20-35W STAPM, 85-95°C temp for laptops"/>
                            </TextBlock>
                        </Border>

                        <!-- STAPM Limit Slider -->
                        <StackPanel Margin="0,0,0,16">
                            <Grid Margin="0,0,0,8">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <TextBlock Grid.Column="0" Text="STAPM Power Limit:" 
                                           FontSize="14" 
                                           Foreground="{StaticResource TextPrimaryBrush}"/>
                                
                                <TextBlock Grid.Column="1" 
                                           Text="{Binding AmdStapmLimitText}" 
                                           FontSize="14" FontWeight="SemiBold"
                                           Foreground="{StaticResource AccentBrush}"/>
                            </Grid>
                            
                            <Slider Minimum="15" Maximum="54" 
                                    TickFrequency="1" 
                                    TickPlacement="BottomRight"
                                    Value="{Binding AmdStapmLimitWatts, Mode=TwoWay}"
                                    IsSnapToTickEnabled="True"/>
                            
                            <!-- Tick labels for key values -->
                            <Grid Margin="0,2,0,0">
                                <TextBlock Text="15W (Quiet)" FontSize="9" Foreground="{StaticResource TextTertiaryBrush}" HorizontalAlignment="Left"/>
                                <TextBlock Text="25W (Balanced)" FontSize="9" Foreground="{StaticResource TextTertiaryBrush}" HorizontalAlignment="Center" Margin="-20,0,0,0"/>
                                <TextBlock Text="54W (Max)" FontSize="9" Foreground="{StaticResource TextTertiaryBrush}" HorizontalAlignment="Right"/>
                            </Grid>
                            
                            <TextBlock Text="Default: 25W (balanced performance/thermals)" 
                                       FontSize="11" 
                                       Foreground="{StaticResource TextSecondaryBrush}"
                                       Margin="0,4,0,0"/>
                        </StackPanel>

                        <!-- Temperature Limit Slider -->
                        <StackPanel Margin="0,0,0,16">
                            <Grid Margin="0,0,0,8">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <TextBlock Grid.Column="0" Text="CPU Temperature Limit:" 
                                           FontSize="14" 
                                           Foreground="{StaticResource TextPrimaryBrush}"/>
                                
                                <TextBlock Grid.Column="1" 
                                           Text="{Binding AmdTempLimitText}" 
                                           FontSize="14" FontWeight="SemiBold"
                                           Foreground="{StaticResource AccentBrush}"/>
                            </Grid>
                            
                            <Slider Minimum="75" Maximum="105" 
                                    TickFrequency="5" 
                                    TickPlacement="BottomRight"
                                    Value="{Binding AmdTempLimitC, Mode=TwoWay}"
                                    IsSnapToTickEnabled="True"/>
                            
                            <!-- Tick labels for key values -->
                            <Grid Margin="0,2,0,0">
                                <TextBlock Text="75°C (Cool)" FontSize="9" Foreground="{StaticResource TextTertiaryBrush}" HorizontalAlignment="Left"/>
                                <TextBlock Text="90°C" FontSize="9" Foreground="{StaticResource TextTertiaryBrush}" HorizontalAlignment="Center" Margin="-10,0,0,0"/>
                                <TextBlock Text="105°C (Stock)" FontSize="9" Foreground="{StaticResource TextTertiaryBrush}" HorizontalAlignment="Right"/>
                            </Grid>
                            
                            <TextBlock Text="Default: 95°C (safe for most Ryzen CPUs)" 
                                       FontSize="11" 
                                       Foreground="{StaticResource TextSecondaryBrush}"
                                       Margin="0,4,0,0"/>
                        </StackPanel>

                        <!-- Apply Buttons -->
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <Button Grid.Column="1" 
                                    Content="Apply Settings" 
                                    Style="{StaticResource ModernButton}"
                                    Command="{Binding ApplyAmdPowerLimitsCommand}"
                                    IsEnabled="{Binding IsAmdCpu}"
                                    Padding="16,8" Margin="0,0,8,0"/>
                            
                            <Button Grid.Column="2" 
                                    Content="Reset to Default" 
                                    Style="{StaticResource ModernButton}"
                                    Command="{Binding ResetAmdPowerLimitsCommand}"
                                    IsEnabled="{Binding IsAmdCpu}"
                                    Padding="16,8"/>
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- HP Omen Gaming Hub Cleanup -->
                <Border Style="{StaticResource SurfaceCard}" Padding="24" Margin="0,0,0,16">
                    <StackPanel>
                        <TextBlock Text="HP Omen Gaming Hub Cleanup" FontSize="20" FontWeight="SemiBold" 
                                   Foreground="{StaticResource TextPrimaryBrush}" Margin="0,0,0,8"/>
                        
                        <TextBlock FontSize="12" Foreground="{StaticResource TextSecondaryBrush}"
                                   Margin="0,0,0,8" TextWrapping="Wrap">
                            <Run Text="Remove HP Omen Gaming Hub and related services. This is optional and will free up system resources."/>
                        </TextBlock>
                        
                        <TextBlock FontSize="12" Margin="0,0,0,16" TextWrapping="Wrap">
                            <Run Text="⚠️ Warning: These operations cannot be undone easily. Create a System Restore Point before proceeding." FontWeight="Bold" Foreground="Orange"/>
                        </TextBlock>

                        <!-- Cleanup Options -->
                        <StackPanel Margin="0,0,0,16">
                            <CheckBox Content="Kill running HP Omen processes" 
                                      IsChecked="{Binding CleanupKillProcesses}"
                                      Foreground="{StaticResource TextPrimaryBrush}"
                                      Margin="0,0,0,8"/>
                            
                            <CheckBox Content="Uninstall HP Omen Gaming Hub application" 
                                      IsChecked="{Binding CleanupUninstallApp}"
                                      Foreground="{StaticResource TextPrimaryBrush}"
                                      Margin="0,0,0,8"/>
                            
                            <CheckBox Content="Remove HP Omen services (OmenService, LightingService)" 
                                      IsChecked="{Binding CleanupRemoveServices}"
                                      Foreground="{StaticResource TextPrimaryBrush}"
                                      Margin="0,0,0,8"/>
                            
                            <CheckBox Content="Clean HP Omen registry entries" 
                                      IsChecked="{Binding CleanupRegistryEntries}"
                                      Foreground="{StaticResource TextPrimaryBrush}"
                                      Margin="0,0,0,8"/>
                            
                            <CheckBox Content="Remove HP Omen legacy installers (winget/AppX)" 
                                      IsChecked="{Binding CleanupRemoveLegacyInstallers}"
                                      Foreground="{StaticResource TextPrimaryBrush}"
                                      Margin="0,0,0,8"/>
                            
                            <CheckBox Content="Remove residual HP Omen files and folders" 
                                      IsChecked="{Binding CleanupRemoveFiles}"
                                      Foreground="{StaticResource TextPrimaryBrush}"/>
                        </StackPanel>

                        <!-- System Restore -->
                        <Border Background="{StaticResource SurfaceDarkBrush}" 
                                CornerRadius="8" Padding="16" Margin="0,0,0,16"
                                BorderBrush="Orange" BorderThickness="1">
                            <StackPanel>
                                <TextBlock Text="⚠️ Create System Restore Point" 
                                           FontSize="14" FontWeight="SemiBold"
                                           Foreground="Orange" Margin="0,0,0,8"/>
                                
                                <TextBlock Text="Highly recommended before performing cleanup operations." 
                                           FontSize="12" 
                                           Foreground="{StaticResource TextSecondaryBrush}"
                                           TextWrapping="Wrap" Margin="0,0,0,8"/>
                                
                                <Button Content="Create Restore Point" 
                                        Style="{StaticResource ModernButton}"
                                        Command="{Binding CreateRestorePointCommand}"
                                        HorizontalAlignment="Left" Padding="16,8"/>
                            </StackPanel>
                        </Border>

                        <!-- Execute Cleanup -->
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Grid.Column="0" 
                                       Text="{Binding CleanupStatusText}" 
                                       FontSize="12" 
                                       Foreground="{StaticResource TextSecondaryBrush}"
                                       VerticalAlignment="Center"/>
                            
                            <Button Grid.Column="1" 
                                    Content="Run Cleanup" 
                                    Style="{StaticResource ModernButton}"
                                    Command="{Binding RunCleanupCommand}"
                                    Padding="16,8"
                                    Background="OrangeRed"/>
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- GPU Switching (Advanced Optimus) -->
                <!-- GPU Power Boost Section -->
                <Border Style="{StaticResource SurfaceCard}" Padding="24" Margin="0,0,0,20">
                    <StackPanel>
                        <TextBlock Text="GPU Power Boost (TGP/Dynamic Boost)" FontSize="20" FontWeight="SemiBold" 
                                   Foreground="{StaticResource TextPrimaryBrush}" Margin="0,0,0,8"/>
                        
                        <TextBlock Text="Control GPU Total Graphics Power (TGP) and Dynamic Boost (PPAB). Higher settings enable more GPU wattage for better gaming performance. Extended option is for RTX 5080 and newer GPUs that may support +25W boost." 
                                   FontSize="12" 
                                   Foreground="{StaticResource TextSecondaryBrush}"
                                   Margin="0,0,0,16" TextWrapping="Wrap"/>

                        <!-- Current Status -->
                        <Grid Margin="0,0,0,16">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Grid.Column="0" Text="Status:" 
                                       FontSize="14" 
                                       Foreground="{StaticResource TextPrimaryBrush}"
                                       Margin="0,0,12,0"/>
                            
                            <TextBlock Grid.Column="1" 
                                       Text="{Binding GpuPowerBoostStatus}" 
                                       FontSize="14" FontWeight="SemiBold"
                                       Foreground="{StaticResource AccentBrush}"/>
                        </Grid>

                        <!-- Power Level Selection - Only show when available -->
                        <Grid Margin="0,0,0,16" 
                              Visibility="{Binding GpuPowerBoostAvailable, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Grid.Column="0" Text="Power Level:" 
                                       FontSize="14" 
                                       Foreground="{StaticResource TextPrimaryBrush}"
                                       VerticalAlignment="Center" Margin="0,0,12,0"/>
                            
                            <ComboBox Grid.Column="1" 
                                      Style="{StaticResource ModernComboBox}"
                                      ItemsSource="{Binding GpuPowerBoostLevels}"
                                      SelectedItem="{Binding GpuPowerBoostLevel}"
                                      Margin="0,0,12,0"/>
                            
                            <Button Grid.Column="2" 
                                    Content="Apply" 
                                    Style="{StaticResource ModernButton}"
                                    Command="{Binding ApplyGpuPowerBoostCommand}"
                                    Padding="16,8"/>
                        </Grid>

                        <TextBlock Text="{Binding GpuPowerBoostDescription}" 
                                   FontSize="12" 
                                   Foreground="{StaticResource TextSecondaryBrush}"
                                   TextWrapping="Wrap" Margin="0,0,0,8"
                                   Visibility="{Binding GpuPowerBoostAvailable, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                        
                        <TextBlock Text="⚠ Note: GPU Power settings are saved but may reset after sleep/reboot on some OMEN models due to BIOS behavior. OmenCore will attempt to restore your last setting on startup." 
                                   FontSize="11" 
                                   Foreground="#FF9800"
                                   TextWrapping="Wrap"
                                   Visibility="{Binding GpuPowerBoostAvailable, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                    </StackPanel>
                </Border>
                
                <!-- GPU Overclocking Section (NVAPI) -->
                <Border Style="{StaticResource SurfaceCard}" Padding="24" Margin="0,0,0,20"
                        Visibility="{Binding GpuOcAvailable, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <StackPanel>
                        <TextBlock Text="GPU Overclocking (NVIDIA)" FontSize="20" FontWeight="SemiBold" 
                                   Foreground="{StaticResource TextPrimaryBrush}" Margin="0,0,0,8"/>
                        
                        <TextBlock Text="Adjust GPU core and memory clock offsets for improved gaming performance. Use at your own risk - improper settings can cause instability or crashes." 
                                   FontSize="12" 
                                   Foreground="{StaticResource TextSecondaryBrush}"
                                   Margin="0,0,0,16" TextWrapping="Wrap"/>

                        <!-- Status -->
                        <Grid Margin="0,0,0,16">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Grid.Column="0" Text="Status:" 
                                       FontSize="14" 
                                       Foreground="{StaticResource TextPrimaryBrush}"
                                       Margin="0,0,12,0"/>
                            
                            <TextBlock Grid.Column="1" 
                                       Text="{Binding GpuOcStatus}" 
                                       FontSize="14" FontWeight="SemiBold"
                                       Foreground="{StaticResource AccentBrush}"
                                       TextWrapping="Wrap"/>
                        </Grid>

                        <!-- Core Clock Offset -->
                        <StackPanel Margin="0,0,0,16">
                            <Grid Margin="0,0,0,8">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Core Clock Offset:" 
                                           FontSize="14" 
                                           Foreground="{StaticResource TextPrimaryBrush}"/>
                                <TextBlock Grid.Column="1" 
                                           Text="{Binding GpuCoreClockOffsetText}" 
                                           FontSize="14" FontWeight="SemiBold"
                                           Foreground="{StaticResource AccentBrush}"/>
                            </Grid>
                            <Slider Value="{Binding GpuCoreClockOffset, Mode=TwoWay}"
                                    Minimum="{Binding GpuCoreOffsetMin}"
                                    Maximum="{Binding GpuCoreOffsetMax}"
                                    TickFrequency="25"
                                    IsSnapToTickEnabled="True"
                                    TickPlacement="BottomRight"/>
                            <TextBlock Text="Negative values = undervolt, Positive = overclock" 
                                       FontSize="11" 
                                       Foreground="{StaticResource TextSecondaryBrush}"
                                       Margin="0,4,0,0"/>
                        </StackPanel>

                        <!-- Memory Clock Offset -->
                        <StackPanel Margin="0,0,0,16">
                            <Grid Margin="0,0,0,8">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Memory Clock Offset:" 
                                           FontSize="14" 
                                           Foreground="{StaticResource TextPrimaryBrush}"/>
                                <TextBlock Grid.Column="1" 
                                           Text="{Binding GpuMemoryClockOffsetText}" 
                                           FontSize="14" FontWeight="SemiBold"
                                           Foreground="{StaticResource AccentBrush}"/>
                            </Grid>
                            <Slider Value="{Binding GpuMemoryClockOffset, Mode=TwoWay}"
                                    Minimum="{Binding GpuMemoryOffsetMin}"
                                    Maximum="{Binding GpuMemoryOffsetMax}"
                                    TickFrequency="50"
                                    IsSnapToTickEnabled="True"
                                    TickPlacement="BottomRight"/>
                        </StackPanel>

                        <!-- Power Limit -->
                        <StackPanel Margin="0,0,0,16">
                            <Grid Margin="0,0,0,8">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Power Limit:" 
                                           FontSize="14" 
                                           Foreground="{StaticResource TextPrimaryBrush}"/>
                                <TextBlock Grid.Column="1" 
                                           Text="{Binding GpuPowerLimitText}" 
                                           FontSize="14" FontWeight="SemiBold"
                                           Foreground="{StaticResource AccentBrush}"/>
                            </Grid>
                            <Slider Value="{Binding GpuPowerLimitPercent, Mode=TwoWay}"
                                    Minimum="{Binding GpuPowerLimitMin}"
                                    Maximum="{Binding GpuPowerLimitMax}"
                                    TickFrequency="5"
                                    IsSnapToTickEnabled="True"
                                    TickPlacement="BottomRight"/>
                            <TextBlock Text="100% = Default TDP. Lower values reduce power/heat, higher allows more boost." 
                                       FontSize="11" 
                                       Foreground="{StaticResource TextSecondaryBrush}"
                                       Margin="0,4,0,0"/>
                        </StackPanel>

                        <!-- Voltage Offset -->
                        <StackPanel Margin="0,0,0,16">
                            <Grid Margin="0,0,0,8">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Voltage Offset:" 
                                           FontSize="14" 
                                           Foreground="{StaticResource TextPrimaryBrush}"/>
                                <TextBlock Grid.Column="1" 
                                           Text="{Binding GpuVoltageOffsetText}" 
                                           FontSize="14" FontWeight="SemiBold"
                                           Foreground="{StaticResource AccentBrush}"/>
                            </Grid>
                            <Slider Value="{Binding GpuVoltageOffsetMv, Mode=TwoWay}"
                                    Minimum="-200"
                                    Maximum="100"
                                    TickFrequency="10"
                                    IsSnapToTickEnabled="True"
                                    TickPlacement="BottomRight"/>
                            <TextBlock Text="Negative = undervolt (reduce heat/power), Positive = overvolt (stability). -50 to -100mV recommended for undervolting." 
                                       FontSize="11" 
                                       Foreground="{StaticResource TextSecondaryBrush}"
                                       Margin="0,4,0,0"/>
                        </StackPanel>
                        
                        <!-- OC Profiles Section -->
                        <Border Background="{StaticResource SurfaceLightBrush}"
                                CornerRadius="8"
                                Padding="12"
                                Margin="0,0,0,16">
                            <StackPanel>
                                <TextBlock Text="OC Profiles" FontSize="14" FontWeight="SemiBold"
                                           Foreground="{StaticResource TextPrimaryBrush}" Margin="0,0,0,8"/>
                                
                                <Grid Margin="0,0,0,8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <ComboBox Grid.Column="0"
                                              ItemsSource="{Binding GpuOcProfiles}"
                                              SelectedItem="{Binding SelectedGpuOcProfile}"
                                              DisplayMemberPath="Name"
                                              Margin="0,0,8,0"/>
                                    
                                    <Button Grid.Column="1"
                                            Content="🗑️"
                                            ToolTip="Delete selected profile"
                                            Command="{Binding DeleteGpuOcProfileCommand}"
                                            Style="{StaticResource ModernButton}"
                                            Padding="8,6"/>
                                </Grid>
                                
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <TextBox Grid.Column="0"
                                             Text="{Binding NewGpuOcProfileName, UpdateSourceTrigger=PropertyChanged}"
                                             Padding="8,6"
                                             Margin="0,0,8,0">
                                        <TextBox.Style>
                                            <Style TargetType="TextBox">
                                                <Setter Property="Background" Value="{StaticResource SurfaceMediumBrush}"/>
                                                <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
                                                <Setter Property="BorderBrush" Value="{StaticResource SurfaceLightBrush}"/>
                                            </Style>
                                        </TextBox.Style>
                                    </TextBox>
                                    
                                    <Button Grid.Column="1"
                                            Content="💾 Save"
                                            ToolTip="Save current settings as new profile"
                                            Command="{Binding SaveGpuOcProfileCommand}"
                                            Style="{StaticResource ModernButton}"
                                            Padding="12,6"/>
                                </Grid>
                            </StackPanel>
                        </Border>

                        <!-- Apply/Reset Buttons -->
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            
                            <Button Grid.Column="1" 
                                    Content="Reset" 
                                    Style="{StaticResource ModernButton}"
                                    Command="{Binding ResetGpuOcCommand}"
                                    Padding="16,8"
                                    Margin="0,0,12,0"/>
                            
                            <Button Grid.Column="2" 
                                    Content="Apply" 
                                    Style="{StaticResource ModernButton}"
                                    Command="{Binding ApplyGpuOcCommand}"
                                    Padding="16,8"/>
                        </Grid>

                        <TextBlock Text="⚠ WARNING: GPU overclocking can cause crashes, artifacts, or system instability. Settings persist after OmenCore restart but reset after Windows reboot." 
                                   FontSize="11" 
                                   Foreground="#FF9800"
                                   TextWrapping="Wrap"
                                   Margin="0,16,0,0"/>
                    </StackPanel>
                </Border>

                <!-- GPU Switching Section (Advanced Optimus) -->
                <Border Style="{StaticResource SurfaceCard}" Padding="24">
                    <StackPanel>
                        <TextBlock Text="GPU Switching (Advanced Optimus)" FontSize="20" FontWeight="SemiBold" 
                                   Foreground="{StaticResource TextPrimaryBrush}" Margin="0,0,0,8"/>
                        
                        <TextBlock Text="Switch between integrated and discrete GPU for optimal performance or battery life." 
                                   FontSize="12" 
                                   Foreground="{StaticResource TextSecondaryBrush}"
                                   Margin="0,0,0,12" TextWrapping="Wrap"/>
                        
                        <!-- Hardware Limitation Warning -->
                        <Border Background="#2D2D1F"
                                BorderBrush="#FF9800"
                                BorderThickness="1"
                                CornerRadius="6"
                                Padding="10,8"
                                Margin="0,0,0,16">
                            <StackPanel>
                                <TextBlock Text="⚠ Hardware Limitation" FontSize="11" FontWeight="SemiBold" Foreground="#FF9800" Margin="0,0,0,4"/>
                                <TextBlock FontSize="10" Foreground="{StaticResource TextSecondaryBrush}" TextWrapping="Wrap">
                                    <Run Text="GPU mode switching requires a system reboot. Some OMEN models only support this via BIOS settings (Security → Device Guard). If switching doesn't work here, try changing the setting in BIOS."/>
                                </TextBlock>
                            </StackPanel>
                        </Border>

                        <!-- Current GPU Mode -->
                        <Grid Margin="0,0,0,16">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Grid.Column="0" Text="Current Mode:" 
                                       FontSize="14" 
                                       Foreground="{StaticResource TextPrimaryBrush}"
                                       Margin="0,0,12,0"/>
                            
                            <TextBlock Grid.Column="1" 
                                       Text="{Binding CurrentGpuMode}" 
                                       FontSize="14" FontWeight="SemiBold"
                                       Foreground="{StaticResource AccentBrush}"/>
                        </Grid>

                        <!-- GPU Mode Selection -->
                        <Grid Margin="0,0,0,16">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Grid.Column="0" Text="Switch To:" 
                                       FontSize="14" 
                                       Foreground="{StaticResource TextPrimaryBrush}"
                                       VerticalAlignment="Center" Margin="0,0,12,0"/>
                            
                            <ComboBox Grid.Column="1" 
                                      Style="{StaticResource ModernComboBox}"
                                      ItemsSource="{Binding GpuSwitchModes}"
                                      SelectedItem="{Binding SelectedGpuMode}"
                                      Margin="0,0,12,0"/>
                            
                            <Button Grid.Column="2" 
                                    Content="Apply (Requires Restart)" 
                                    Style="{StaticResource ModernButton}"
                                    Command="{Binding SwitchGpuModeCommand}"
                                    Padding="16,8"/>
                        </Grid>

                        <TextBlock Text="💡 Tip: Hybrid mode saves battery by using integrated GPU for light tasks. Discrete mode provides maximum performance but uses more power." 
                                   FontSize="11" 
                                   Foreground="{StaticResource TextSecondaryBrush}"
                                   TextWrapping="Wrap"/>
                    </StackPanel>
                </Border>
            </StackPanel>
        </ScrollViewer>
        
        <!-- Loading Overlay -->
        <controls:LoadingOverlay Grid.RowSpan="2" Panel.ZIndex="1000" />
    </Grid>
</UserControl>
